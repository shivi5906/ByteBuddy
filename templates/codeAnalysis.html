<!DOCTYPE html>
<html lang="en" class="h-full bg-terminal-bg">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    <title>ByteBuddy - Code Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        // Syntax highlighting functionality
        function updateHighlightedCode() {
            const textarea = document.getElementById('code');
            const highlightedCode = document.getElementById('highlightedCode');
            const lineNumbers = document.getElementById('lineNumbers');
            
            // Update line numbers
            const lines = textarea.value.split('\n');
            lineNumbers.innerHTML = lines.map((_, i) => i + 1).join('<br>');
            
            // Apply syntax highlighting
            const language = document.getElementById('language').value;
            highlightedCode.innerHTML = Prism.highlight(
                textarea.value, 
                Prism.languages[language] || Prism.languages.python, 
                language
            );
            
            // Sync scroll positions
            syncScroll();
        }

        function syncScroll() {
            const textarea = document.getElementById('code');
            const highlightedCode = document.getElementById('highlightedCode');
            const lineNumbers = document.getElementById('lineNumbers');
            
            highlightedCode.scrollTop = textarea.scrollTop;
            highlightedCode.scrollLeft = textarea.scrollLeft;
            lineNumbers.scrollTop = textarea.scrollTop;
        }

        function resetCodeEditor() {
            document.getElementById('code').value = '';
            updateHighlightedCode();
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Update on language change
            document.getElementById('language').addEventListener('change', updateHighlightedCode);
            
            // Initial update
            updateHighlightedCode();
        });
        
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        'terminal-bg': '#121212',
                        'terminal-bg-secondary': '#1A1A1A',
                        'terminal-border': '#2A2A2A',
                        'terminal-text': '#E0E0E0',
                        'terminal-white': '#FFFFFF',
                        'electric-blue': '#007BFF',
                        'bright-blue': '#00BFFF',
                        'cyan': '#40E0D0',
                        'warning-red': '#FF4757',
                        'warning-orange': '#FFA726',
                        'success-green': '#2ED573'
                    },
                    animation: {
                        'typing': 'typing 3.5s steps(40, end)',
                        'blink-caret': 'blink-caret 0.75s step-end infinite',
                        'scan': 'scan 2s linear infinite',
                        'fade-in-up': 'fade-in-up 0.8s ease-out'
                    },
                    keyframes: {
                        'typing': {
                            'from': { width: '0' },
                            'to': { width: '100%' }
                        },
                        'blink-caret': {
                            'from, to': { 'border-color': 'transparent' },
                            '50%': { 'border-color': '#007BFF' }
                        },
                        'scan': {
                            '0%': { 'background-position': '0 0' },
                            '100%': { 'background-position': '0 -20px' }
                        },
                        'fade-in-up': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
          /* Custom VS Code-like theme */
        .code-input {
            font-family: 'JetBrains Mono', monospace;
            tab-size: 4;
        }
        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
            color: #6A9955; /* VS Code green comments */
        }
        .token.punctuation {
            color: #D4D4D4; /* Light gray */
        }
        .token.keyword {
            color: #569CD6; /* VS Code blue keywords */
        }
        .token.operator {
            color: #D4D4D4; /* Light gray */
        }
        .token.string {
            color: #CE9178; /* VS Code orange strings */
        }
        .token.number {
            color: #B5CEA8; /* VS Code green numbers */
        }
        .token.function {
            color: #DCDCAA; /* VS Code yellow functions */
        }
        .token.class-name {
            color: #4EC9B0; /* VS Code teal classes */
        }
        .token.boolean {
            color: #569CD6; /* VS Code blue */
        }
        .token.selector {
            color: #D7BA7D; /* VS Code gold */
        }
        .token.property {
            color: #9CDCFE; /* VS Code light blue */
        }
        .token.tag {
            color: #569CD6; /* VS Code blue */
        }
        .token.attr-value {
            color: #CE9178; /* VS Code orange */
        }
        .matrix-bg {
            background-image: 
                linear-gradient(to bottom, rgba(18, 18, 18, 0.9), rgba(26, 26, 26, 0.9)),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ctext x='0' y='60' font-family='monospace' font-size='10' fill='%23007BFF' fill-opacity='0.05'%3E0101%3C/text%3E%3C/svg%3E");
        }
        .terminal-window {
            background: linear-gradient(135deg, #121212 0%, #1A1A1A 100%);
            border: 1px solid #2A2A2A;
            box-shadow: 0 8px 32px rgba(0, 123, 255, 0.1);
            transition: box-shadow 0.3s ease;
        }
        .terminal-window:hover {
            box-shadow: 0 8px 32px rgba(0, 123, 255, 0.2);
        }
        .scan-button {
            background-image: linear-gradient(
                to bottom,
                rgba(0, 123, 255, 0.3) 0%,
                transparent 50%,
                rgba(0, 123, 255, 0.3) 100%
            );
            background-size: 100% 20px;
        }
        .prompt::before {
            content: "user@bytebuddy:~$";
            color: #2ED573;
            margin-right: 8px;
        }
        .root-prompt::before {
            content: "root@bytebuddy:~#";
            color: #FF4757;
            margin-right: 8px;
        }
    </style>
</head>
<body class="h-full font-mono text-terminal-text matrix-bg flex flex-col">
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-terminal-bg border-b border-terminal-border py-3 px-6">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <div class="flex space-x-2 mr-4">
                    <div class="w-3 h-3 rounded-full bg-warning-red"></div>
                    <div class="w-3 h-3 rounded-full bg-warning-orange"></div>
                    <div class="w-3 h-3 rounded-full bg-success-green"></div>
                </div>
                <h1 class="text-xl font-bold text-terminal-white">
                    <span class="text-electric-blue">Byte</span><span class="text-bright-blue">Buddy</span>
                </h1>
                <div class="text-cyan ml-4">code_analysis.py</div>
            </div>
            <nav class="flex space-x-4">
                <a href="{{ url_for('index') }}" class="px-3 py-1 rounded border border-terminal-border hover:border-electric-blue hover:text-electric-blue transition-colors duration-200">
                    ./home
                </a>
                <a href="#" class="px-3 py-1 rounded border border-terminal-border hover:border-electric-blue hover:text-electric-blue transition-colors duration-200">
                    man docs
                </a>
            </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 space-y-8">
        <!-- Input Section -->
        <section class="terminal-window rounded-lg p-6 animate-fade-in-up">
            <div class="prompt text-terminal-white mb-4">Enter your code for analysis:</div>
            
            <form id="codeAnalysisForm" class="space-y-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <!-- Language Selector -->
                    <div class="w-full md:w-48">
                        <label for="language" class="block text-sm font-medium text-cyan mb-2">Language</label>
                        <select id="language" name="language" class="w-full bg-terminal-bg-secondary border border-terminal-border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-electric-blue focus:border-electric-blue">
                            <option value="python">Python</option>
                            <option value="cpp">C++</option>
                            <option value="java">Java</option>
                            <option value="javascript">JavaScript</option>
                            <option value="go">Go</option>
                            <option value="rust">Rust</option>
                        </select>
                    </div>
                </div>

                <!-- Enhanced Code Input -->
                <div>
                    <label for="code" class="block text-sm font-medium text-cyan mb-2">Code Input</label>
                    <div class="relative">
                        <!-- Line numbers -->
                        <div class="absolute left-0 top-0 h-full w-10 bg-terminal-bg-secondary border-r border-terminal-border text-right pr-2 pt-3 text-xs text-terminal-border select-none" id="lineNumbers">1</div>
                        
                        <!-- Code editor area -->
                        <pre class="absolute inset-0 overflow-auto pl-12 pt-3 pb-3 text-sm pointer-events-none" id="highlightedCode"></pre>
                        
                        <!-- Textarea for actual input -->
                        <textarea 
                            id="code" 
                            name="code" 
                            rows="12" 
                            class="code-input w-full bg-terminal-bg-secondary border border-terminal-border rounded px-4 py-3 pl-14 text-sm focus:outline-none focus:ring-1 focus:ring-electric-blue focus:border-electric-blue text-terminal-white placeholder-terminal-border" 
                            placeholder="Paste your code here..."
                            spellcheck="false"
                            oninput="updateHighlightedCode()"
                            onscroll="syncScroll()"
                        ></textarea>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-4">
                    <button type="submit" class="scan-button px-6 py-2 bg-electric-blue hover:bg-bright-blue text-terminal-white font-bold rounded transition-all duration-200 flex items-center">
                        <span class="root-prompt">sudo ./analyze</span>
                    </button>
                    <button type="reset" class="px-6 py-2 bg-terminal-bg-secondary hover:bg-terminal-bg border-2 border-electric-blue text-electric-blue rounded transition-all duration-200" onclick="resetCodeEditor()">
                        man reset
                    </button>
                </div>
            </form>
        </section>

        <!-- Results Section -->
        {% if results %}
        <section class="space-y-6 animate-fade-in-up" style="animation-delay: 0.2s">
            <h2 class="text-xl font-bold text-terminal-white">
                <span class="text-electric-blue">Analysis</span> <span class="text-bright-blue">Results</span>
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Explanation Panel -->
                <div class="terminal-window rounded-lg p-5 animate-fade-in-up" style="animation-delay: 0.3s">
                    <div class="flex items-center mb-4">
                        <div class="w-3 h-3 rounded-full bg-electric-blue mr-2"></div>
                        <h3 class="font-bold text-electric-blue">Code Explanation</h3>
                    </div>
                    <div class="space-y-3 text-sm">
                        {% for line, explanation in results.explanations.items() %}
                        <div class="flex border-b border-terminal-border pb-3">
                            <div class="text-cyan mr-3 font-bold">{{ loop.index }}.</div>
                            <div>
                                <div class="text-bright-blue font-mono mb-1">{{ line }}</div>
                                <div class="text-terminal-text">{{ explanation }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Suggestions Panel -->
                <div class="terminal-window rounded-lg p-5 animate-fade-in-up" style="animation-delay: 0.4s">
                    <div class="flex items-center mb-4">
                        <div class="w-3 h-3 rounded-full bg-bright-blue mr-2"></div>
                        <h3 class="font-bold text-bright-blue">Optimization Suggestions</h3>
                    </div>
                    <div class="space-y-3 text-sm">
                        {% for suggestion in results.suggestions %}
                        <div class="flex items-start">
                            <div class="mr-2 mt-0.5">
                                {% if suggestion.type == 'improvement' %}
                                <span class="text-success-green">✓</span>
                                {% elif suggestion.type == 'warning' %}
                                <span class="text-warning-orange">⚠</span>
                                {% else %}
                                <span class="text-cyan">•</span>
                                {% endif %}
                            </div>
                            <div class="text-terminal-text">{{ suggestion.message }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Complexity Panel -->
                <div class="terminal-window rounded-lg p-5 animate-fade-in-up" style="animation-delay: 0.5s">
                    <div class="flex items-center mb-4">
                        <div class="w-3 h-3 rounded-full bg-cyan mr-2"></div>
                        <h3 class="font-bold text-cyan">Complexity Analysis</h3>
                    </div>
                    <div class="space-y-4 text-sm">
                        <div>
                            <h4 class="font-bold text-electric-blue mb-1">Time Complexity</h4>
                            <div class="px-3 py-2 bg-terminal-bg rounded text-electric-blue font-bold">
                                {{ results.complexity.time }}
                            </div>
                            <p class="text-terminal-text mt-1">{{ results.complexity.time_explanation }}</p>
                        </div>
                        <div>
                            <h4 class="font-bold text-bright-blue mb-1">Space Complexity</h4>
                            <div class="px-3 py-2 bg-terminal-bg rounded text-bright-blue font-bold">
                                {{ results.complexity.space }}
                            </div>
                            <p class="text-terminal-text mt-1">{{ results.complexity.space_explanation }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}
    </main>

    <!-- Footer -->
    <footer class="bg-terminal-bg border-t border-terminal-border py-4 px-6 text-center text-sm text-terminal-text">
        <div class="container mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-2 md:mb-0">
                    <span class="text-electric-blue">ByteBuddy</span> © {{ now.year }} | 
                    <span class="text-cyan">v1.0.0</span>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="hover:text-bright-blue transition-colors duration-200">./docs</a>
                    <a href="#" class="hover:text-bright-blue transition-colors duration-200">./github</a>
                    <a href="#" class="hover:text-bright-blue transition-colors duration-200">./contact</a>
                </div>
            </div>
            <div class="mt-2 text-xs text-terminal-border">
                System: Linux x86_64 | Memory: 16GB | CPU: 8 cores @ 3.2GHz
            </div>
        </div>
    </footer>
</body>
</html>